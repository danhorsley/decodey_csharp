<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Decodey.ViewModels"
             x:Class="Decodey.Views.SignupDialog"
             x:DataType="viewmodel:SignupViewModel"
             Title="Create Account">

    <Grid BackgroundColor="{DynamicResource PageBackgroundColor}">
        <ScrollView>
            <VerticalStackLayout Spacing="16" Padding="24" MaximumWidthRequest="480" HorizontalOptions="Center">
                <!-- Close button -->
                <Button 
                    Text="×"
                    FontSize="24"
                    HorizontalOptions="End"
                    VerticalOptions="Start"
                    WidthRequest="44"
                    HeightRequest="44"
                    Padding="0"
                    Command="{Binding CloseCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{DynamicResource PrimaryTextColor}"/>

                <!-- Header -->
                <Label 
                    Text="Create Account"
                    FontSize="28"
                    FontAttributes="Bold"
                    HorizontalOptions="Center" 
                    Margin="0,0,0,12"
                    TextColor="{DynamicResource PrimaryTextColor}"/>

                <!-- Error message, if any -->
                <Label 
                    Text="{Binding ErrorMessage}"
                    IsVisible="{Binding HasError}"
                    TextColor="{DynamicResource DangerColor}"
                    Margin="0,0,0,8"/>

                <!-- Sign up form -->
                <VerticalStackLayout Spacing="16" Margin="0,8,0,0">
                    <!-- Email -->
                    <VerticalStackLayout Spacing="4">
                        <Label 
                            Text="Email"
                            TextColor="{DynamicResource PrimaryTextColor}"/>
                        <Entry 
                            Text="{Binding Email}" 
                            Placeholder="Enter your email"
                            Keyboard="Email"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            BackgroundColor="{DynamicResource InputBackgroundColor}"/>
                    </VerticalStackLayout>

                    <!-- Username -->
                    <VerticalStackLayout Spacing="4">
                        <Label 
                            Text="Username (for leaderboards)"
                            TextColor="{DynamicResource PrimaryTextColor}"/>
                        <Entry 
                            Text="{Binding Username}" 
                            Placeholder="Enter a username"
                            TextColor="{Binding UsernameColor}"
                            BackgroundColor="{DynamicResource InputBackgroundColor}"/>

                        <!-- Username status -->
                        <Label 
                            Text="{Binding UsernameStatus}"
                            IsVisible="{Binding UsernameStatus, Converter={StaticResource StringNotEmptyConverter}}"
                            TextColor="{Binding UsernameColor}"
                            FontSize="12"/>
                    </VerticalStackLayout>

                    <!-- Password -->
                    <VerticalStackLayout Spacing="4">
                        <Label 
                            Text="Password"
                            TextColor="{DynamicResource PrimaryTextColor}"/>
                        <Entry 
                            Text="{Binding Password}" 
                            IsPassword="True"
                            Placeholder="Enter your password"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            BackgroundColor="{DynamicResource InputBackgroundColor}"/>
                    </VerticalStackLayout>

                    <!-- Confirm Password -->
                    <VerticalStackLayout Spacing="4">
                        <Label 
                            Text="Confirm Password"
                            TextColor="{DynamicResource PrimaryTextColor}"/>
                        <Entry 
                            Text="{Binding ConfirmPassword}" 
                            IsPassword="True"
                            Placeholder="Confirm your password"
                            TextColor="{DynamicResource PrimaryTextColor}"
                            BackgroundColor="{DynamicResource InputBackgroundColor}"/>
                    </VerticalStackLayout>

                    <!-- Email consent -->
                    <VerticalStackLayout Spacing="8" Margin="0,8,0,0">
                        <HorizontalStackLayout Spacing="8">
                            <CheckBox IsChecked="{Binding EmailConsent}" Color="{DynamicResource PrimaryColor}"/>
                            <Label 
                                Text="I consent to receive occasional emails with game updates, news, and third-party offers."
                                VerticalOptions="Center"
                                TextColor="{DynamicResource PrimaryTextColor}"/>
                        </HorizontalStackLayout>

                        <Label 
                            Text="This is the only way to support the game - we don't sell your data or show ads. You can unsubscribe at any time."
                            FontSize="12"
                            TextColor="{DynamicResource SecondaryTextColor}"
                            Margin="32,0,0,0"/>
                    </VerticalStackLayout>

                    <!-- Create account button -->
                    <Button 
                        Text="{Binding SignupButtonText}"
                        Command="{Binding SignupCommand}"
                        IsEnabled="{Binding IsNotBusy}"
                        BackgroundColor="{DynamicResource PrimaryColor}"
                        TextColor="{DynamicResource OnPrimaryColor}"
                        FontAttributes="Bold"
                        Margin="0,12,0,0"/>

                    <!-- Back to login -->
                    <Button 
                        Text="Back to Login" 
                        Command="{Binding BackToLoginCommand}"
                        BackgroundColor="Transparent"
                        TextColor="{DynamicResource SecondaryColor}"
                        Margin="0,8,0,0"/>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Loading overlay -->
        <Grid 
            BackgroundColor="#80000000"
            IsVisible="{Binding IsBusy}">
            <ActivityIndicator 
                IsRunning="{Binding IsBusy}"
                Color="{DynamicResource PrimaryColor}"
                WidthRequest="48"
                HeightRequest="48"/>
        </Grid>
    </Grid>
</ContentPage>